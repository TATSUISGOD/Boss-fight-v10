<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:20px}
button,input{font-size:15px;padding:8px 14px;margin:4px}
#tapBtn{font-size:26px;padding:28px 56px;margin-top:20px}
.hidden{display:none!important}
.boss{font-size:72px}
.player{font-size:60px}
.hp-bar{width:80%;height:20px;background:#444;margin:10px auto;border-radius:10px;overflow:hidden}
.hp{height:100%;background:red}
.overlay{
position:fixed;inset:0;background:rgba(0,0,0,.9);
display:flex;justify-content:center;align-items:center;
z-index:999;font-size:20px;text-align:center;padding:20px
}
.rare{color:#4af}.sr{color:#c6f}.hr{color:#fa4}.ur{color:gold}
.lr{
background:linear-gradient(45deg,red,orange,yellow,green,cyan,blue,purple);
-webkit-background-clip:text;color:transparent;font-weight:bold
}
.grid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:8px;margin-top:10px
}
.card{
border:2px solid #555;
border-radius:10px;
padding:8px;background:#222
}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>

<p>
ğŸ’° <span id="coin">0</span>
ã€€ğŸ’ <span id="dia">0</span>
ã€€âš” +<span id="atk">0</span>
</p>

<div class="player" id="player">ğŸ™‚</div>

<!-- ã‚¬ãƒãƒ£ -->
<button onclick="drawGacha()">ğŸ° ã‚¬ãƒãƒ£</button>
<button onclick="draw10()">ğŸ° 10é€£</button>
<button onclick="drawDiaGacha()">ğŸ’ ä¸Šä½</button>
<button onclick="drawDia10()">ğŸ’ ä¸Šä½10é€£</button>
<button onclick="showDex()">ğŸ“– å›³é‘‘</button>

<hr>

<input id="diaNum" type="number" min="1" placeholder="å¤‰æ›æ•°">
<button onclick="exchangeDia()">ğŸ’°â†’ğŸ’å¤‰æ›</button>

<hr>

<!-- ãƒœã‚¹ä¸€è¦§ï¼ˆå…¨éƒ¨ãƒœã‚¿ãƒ³ï¼‰ -->
<div id="select">
<h2>ãƒœã‚¹é¸æŠ</h2>

<h3>ğŸŒ± åºç›¤</h3>
<button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢',10)">ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ã‚´ãƒ–ãƒªãƒ³',180,'ğŸ‘º',18)">ã‚´ãƒ–ãƒªãƒ³</button>
<button onclick="startBattle('ã‚¦ãƒ«ãƒ•',260,'ğŸº',26)">ã‚¦ãƒ«ãƒ•</button>
<button onclick="startBattle('ã‚ªãƒ¼ã‚¯',400,'ğŸ‘¹',40)">ã‚ªãƒ¼ã‚¯</button>

<h3>ğŸ”¥ ä¸­ç›¤</h3>
<button onclick="startBattle('ãƒˆãƒ­ãƒ¼ãƒ«',800,'ğŸª¨',80)">ãƒˆãƒ­ãƒ¼ãƒ«</button>
<button onclick="startBattle('ãƒ¯ã‚¤ãƒãƒ¼ãƒ³',1400,'ğŸ²',140)">ãƒ¯ã‚¤ãƒãƒ¼ãƒ³</button>
<button onclick="startBattle('ãƒ€ãƒ¼ã‚¯ãƒŠã‚¤ãƒˆ',2200,'âš”ï¸',220)">ãƒ€ãƒ¼ã‚¯ãƒŠã‚¤ãƒˆ</button>
<button onclick="startBattle('ãƒ‡ãƒ¼ãƒ¢ãƒ³',3500,'ğŸ˜ˆ',350)">ãƒ‡ãƒ¼ãƒ¢ãƒ³</button>

<h3>ğŸŒŒ çµ‚ç›¤</h3>
<button onclick="startBattle('ç¥ç«œ',8000,'ğŸ‰âœ¨',800)">ç¥ç«œ</button>
<button onclick="startBattle('è™šç„¡ç‹',50000,'ğŸ•³ï¸ğŸ‘‘',3000)">è™šç„¡ç‹</button>
<button onclick="startBattle('çµ‚ç„‰ç«œ',150000,'ğŸ’€ğŸ²',8000)">çµ‚ç„‰ç«œ</button>
<button onclick="startBattle('å‰µä¸–ç¥',300000,'ğŸŒŒâœ¨',15000)">å‰µä¸–ç¥</button>

<br><br>
<button onclick="startRush()">ğŸ”¥ ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥</button>
</div>

<!-- ãƒãƒˆãƒ«ç”»é¢ -->
<div id="game" class="hidden">
<h2 id="bossName"></h2>
<div class="boss" id="bossIcon"></div>
<div class="hp-bar"><div class="hp" id="hp"></div></div>
<p>HP: <span id="hpText"></span></p>
<button id="tapBtn">ã‚¿ãƒƒãƒ—ï¼</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<script>
let coin=+localStorage.getItem("coin")||0;
let dia=+localStorage.getItem("dia")||0;
let atkBonus=+localStorage.getItem("atkBonus")||0;
let dex=JSON.parse(localStorage.getItem("dex")||"{}");

let bossHp=0,maxHp=0,reward=0;
let rush=false,rushKills=0,rushEnd=0;

const coinEl=document.getElementById("coin");
const diaEl=document.getElementById("dia");
const atkEl=document.getElementById("atk");
const overlay=document.getElementById("overlay");
const player=document.getElementById("player");

function hideOverlay(){overlay.classList.add("hidden");overlay.innerHTML=""}
overlay.onclick=hideOverlay;
function showOverlay(html){
overlay.innerHTML=html+"<br><br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>";
overlay.classList.remove("hidden");
}

function save(){
localStorage.setItem("coin",coin);
localStorage.setItem("dia",dia);
localStorage.setItem("atkBonus",atkBonus);
localStorage.setItem("dex",JSON.stringify(dex));
coinEl.textContent=coin;
diaEl.textContent=dia;
atkEl.textContent=atkBonus.toFixed(1);
player.textContent=atkBonus>=10?"ğŸ‘‘ğŸ”¥":atkBonus>=5?"ğŸ˜âœ¨":"ğŸ™‚";
}
save();

/* ===== ã‚¬ãƒãƒ£ ===== */
const normalTable=[
["LR",2,1.5,"lr"],
["UR",5,1,"ur"],
["HR",15,0.5,"hr"],
["SR",28,0.3,"sr"],
["R",50,0.1,"rare"]
];
const diaTable=[
["LR",40,2,"lr"],
["UR",45,1.5,"ur"],
["DIVINE",15,5,"hr"]
];

function roll(table){
let r=Math.random()*100,sum=0;
for(let g of table){sum+=g[1];if(r<sum)return g}
}

function drawGacha(){
if(coin<100)return showOverlay("ã‚³ã‚¤ãƒ³ä¸è¶³");
coin-=100;
let g=roll(normalTable);
atkBonus+=g[2];
dex[g[0]]=(dex[g[0]]||0)+1;
save();
showOverlay(`<div class="${g[3]}">${g[0]} +${g[2]}</div>`);
}

function draw10(){
if(coin<1000)return showOverlay("ã‚³ã‚¤ãƒ³ä¸è¶³");
coin-=1000;
let html="<h3>ğŸ° 10é€£çµæœ</h3><div class='grid'>";
for(let i=0;i<10;i++){
let g=roll(normalTable);
atkBonus+=g[2];
dex[g[0]]=(dex[g[0]]||0)+1;
html+=`<div class="card ${g[3]}">${g[0]}<br>+${g[2]}</div>`;
}
html+="</div>";
save();
showOverlay(html);
}

function drawDiaGacha(){
if(dia<1)return showOverlay("ãƒ€ã‚¤ãƒ¤ä¸è¶³");
dia--;
let g=roll(diaTable);
atkBonus+=g[2];
dex[g[0]]=(dex[g[0]]||0)+1;
save();
showOverlay(`<div class="${g[3]}">ğŸ’ ${g[0]} +${g[2]}</div>`);
}

function drawDia10(){
if(dia<10)return showOverlay("ãƒ€ã‚¤ãƒ¤ä¸è¶³");
dia-=10;
let html="<h3>ğŸ’ ä¸Šä½10é€£</h3><div class='grid'>";
for(let i=0;i<10;i++){
let g=roll(diaTable);
atkBonus+=g[2];
dex[g[0]]=(dex[g[0]]||0)+1;
html+=`<div class="card ${g[3]}">${g[0]}<br>+${g[2]}</div>`;
}
html+="</div>";
save();
showOverlay(html);
}

/* ===== å›³é‘‘ ===== */
function showDex(){
let h="<h2>ğŸ“– å›³é‘‘</h2>";
for(let k in dex)h+=`${k} Ã— ${dex[k]}<br>`;
showOverlay(h);
}

/* ===== ãƒãƒˆãƒ« ===== */
function startBattle(n,h,i,r){
hideOverlay();
rush=false;
bossName.textContent=n;
bossIcon.textContent=i;
bossHp=maxHp=h;
reward=r;
select.classList.add("hidden");
game.classList.remove("hidden");
updateHp();
}

tapBtn.onclick=()=>{
bossHp-=1+atkBonus;
if(bossHp<=0){
coin+=reward;
save();
game.classList.add("hidden");
select.classList.remove("hidden");
showOverlay(`ğŸ‰ æ’ƒç ´ï¼<br>ğŸ’° +${reward}`);
}
updateHp();
};

function updateHp(){
hpText.textContent=Math.ceil(bossHp);
hp.style.width=(bossHp/maxHp*100)+"%";
}

/* ===== ãƒœã‚¹ãƒ©ãƒƒã‚·ãƒ¥ ===== */
function getRushBoss(){
let k=rushKills;
if(k<5) return {n:"é›‘é­š",i:"ğŸ‘¾",h:300+k*100};
if(k<10) return {n:"å…µ",i:"âš”ï¸ğŸ‘¹",h:1200+(k-5)*400};
if(k<20) return {n:"å°†è»",i:"ğŸ”¥ğŸ˜ˆ",h:5000+(k-10)*1500};
return {n:"è¦‡ç‹",i:"ğŸŒŒğŸ‘‘",h:20000+(k-20)*6000};
}

function startRush(){
hideOverlay();
rush=true;
rushKills=0;
rushEnd=Date.now()+60000;
spawnRush();
select.classList.add("hidden");
game.classList.remove("hidden");
}

function spawnRush(){
let b=getRushBoss();
bossName.textContent="ãƒ©ãƒƒã‚·ãƒ¥"+b.n;
bossIcon.textContent=b.i;
bossHp=maxHp=b.h;
updateHp();
}

</script>
</body>
</html>
